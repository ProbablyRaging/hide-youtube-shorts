chrome.runtime.onInstalled.addListener(async t=>{if(t.reason==="install"&&(chrome.storage.sync.set({presentModal:!0,toggleState:!0,toggleNavState:!0,toggleHomeFeedState:!0,toggleHomeFeedStateLives:!1,toggleHomeFeedStatePremieres:!1,toggleSubscriptionFeedState:!0,toggleSubscriptionFeedStateLives:!1,toggleSubscriptionFeedStatePremieres:!1,toggleTrendingFeedState:!0,toggleSearchState:!0,toggleRecommendedState:!0,toggleTabState:!0,toggleHomeTabState:!0,toggleTurboState:!1,toggleRegularState:!0,toggleNotificationState:!0}).catch(()=>{console.log("[STORAGE] Could not set storage item")}),chrome.tabs.query({url:["https://www.youtube.com/*","https://m.youtube.com/*"]},function(s){s.forEach(o=>{chrome.tabs.reload(o.id)})}),chrome.action.setBadgeBackgroundColor({color:"#ed5a64"}),chrome.action.setBadgeText({text:"1"})),t.reason==="update"){const s=["toggleState","toggleNavState","toggleHomeFeedState","toggleHomeFeedStateLives","toggleHomeFeedStatePremieres","toggleSubscriptionFeedState","toggleSubscriptionFeedStateLives","toggleSubscriptionFeedStatePremieres","toggleTrendingFeedState","toggleSearchState","toggleRecommendedState","toggleTabState","toggleHomeTabState","toggleTurboState","toggleRegularState","toggleNotificationState"],o=await chrome.storage.sync.get(s);for(const e of s)(!(e in o)||o[e]===void 0)&&await chrome.storage.sync.set({[e]:!1});chrome.storage.sync.set({presentModal:!1}).catch(()=>{console.log("[STORAGE] Could not set storage item")})}});function a(){return chrome.runtime.id?chrome.storage.sync.get(["toggleState","toggleNavState","toggleHomeFeedState","toggleHomeFeedStateLives","toggleHomeFeedStatePremieres","toggleSubscriptionFeedState","toggleSubscriptionFeedStateLives","toggleSubscriptionFeedStatePremieres","toggleTrendingFeedState","toggleSearchState","toggleRecommendedState","toggleTabState","toggleHomeTabState","toggleTurboState","toggleRegularState","toggleNotificationState"]):location.reload()}function c(t,s){chrome.scripting.insertCSS({files:s,target:{tabId:t}}).catch(o=>{console.log("Error inserting styles",o)})}function g(t,s){chrome.scripting.removeCSS({files:s,target:{tabId:t}}).catch(o=>{console.log("Error removing styles",o)})}function x(t){chrome.scripting.removeCSS({files:["channel_shorts_tab.css","assets/home_lives.css","assets/home_premieres.css","assets/home_shorts.css","assets/home_tab_shorts.css","assets/navigation_button.css","assets/notification_shorts.css","assets/recommended_shorts.css","assets/search_shorts.css","assets/subscriptions_feed_fix.css","assets/subscriptions_lives.css","assets/subscriptions_premieres.css","assets/subscriptions_shorts.css","assets/subscriptions_shorts_list.css","assets/trending_shorts.css"],target:{tabId:t}}).catch(s=>{console.log("Error removing styles",s)}),chrome.scripting.executeScript({function:()=>{let s=0;function o(){if(s>=25){s=0;return}const e=document.querySelectorAll(".tab-content"),r=Array.from(e).filter(i=>i.textContent.replace(/\s/g,"").replace(/\n/g,"")==="Shorts");r.length>0?(r.forEach(i=>{i.parentNode.style.display="inline-flex"}),s=0):(s++,setTimeout(o,100))}o()},target:{tabId:t}}).catch(s=>{console.log("Error executing script",s)})}chrome.runtime.onMessage.addListener(async function(t,s,o){if(t.checkStates){const e=await a();chrome.tabs.query({url:["https://www.youtube.com/*","https://m.youtube.com/*"]},function(r){r.forEach(i=>{t.checkStates==="toggleState"&&N(i,i.id,e.toggleState),t.checkStates==="toggleNavState"&&f(i,i.id,e.toggleNavState),t.checkStates==="toggleHomeFeedState"&&h(i,i.id,e.toggleHomeFeedState),t.checkStates==="toggleHomeFeedStateLives"&&m(i,i.id,e.toggleHomeFeedStateLives),t.checkStates==="toggleHomeFeedStatePremieres"&&d(i,i.id,e.toggleHomeFeedStatePremieres),t.checkStates==="toggleSubscriptionFeedState"&&p(i,i.id,e.toggleSubscriptionFeedState),t.checkStates==="toggleSubscriptionFeedStateLives"&&w(i,i.id,e.toggleSubscriptionFeedStateLives),t.checkStates==="toggleSubscriptionFeedStatePremieres"&&y(i,i.id,e.toggleSubscriptionFeedStatePremieres),t.checkStates==="toggleTrendingFeedState"&&F(i,i.id,e.toggleTrendingFeedState),t.checkStates==="toggleSearchState"&&v(i,i.id,e.toggleSearchState),t.checkStates==="toggleRecommendedState"&&_(i,i.id,e.toggleRecommendedState),t.checkStates==="toggleNotificationState"&&T(i,i.id,e.toggleNotificationState),t.checkStates==="toggleTabState"&&k(i,i.id,e.toggleTabState),t.checkStates==="toggleHomeTabState"&&H(i,i.id,e.toggleHomeTabState),t.checkStates==="toggleRegularState"&&L(i,i.id,e.toggleRegularState)})})}});chrome.tabs.onUpdated.addListener(async function(t,s,o){if(chrome.runtime.id&&(o.url.startsWith("https://www.youtube.com/")||o.url.startsWith("https://m.youtube.com/"))){const e=await a();if(!e.toggleState||s.status!=="loading")return;e.toggleNavState&&f(o,t,e.toggleNavState),e.toggleHomeFeedState&&h(o,t,e.toggleHomeFeedState),e.toggleHomeFeedStateLives&&m(o,t,e.toggleHomeFeedStateLives),e.toggleHomeFeedStatePremieres&&d(o,t,e.toggleHomeFeedStatePremieres),e.toggleSubscriptionFeedState&&p(o,t,e.toggleSubscriptionFeedState),e.toggleSubscriptionFeedStateLives&&w(o,t,e.toggleSubscriptionFeedStateLives),e.toggleSubscriptionFeedStatePremieres&&y(o,t,e.toggleSubscriptionFeedStatePremieres),e.toggleTrendingFeedState&&F(o,t,e.toggleTrendingFeedState),e.toggleSearchState&&v(o,t,e.toggleSearchState),e.toggleRecommendedState&&_(o,t,e.toggleRecommendedState),e.toggleNotificationState&&T(o,t,e.toggleNotificationState),e.toggleTabState&&k(o,t,e.toggleTabState),e.toggleHomeTabState&&H(o,t,e.toggleHomeTabState),e.toggleRegularState&&L(o,t,e.toggleRegularState)}});async function N(t,s,o){if(o){const e=await a();e.toggleNavState&&f(t,s,e.toggleNavState),e.toggleHomeFeedState&&h(t,s,e.toggleHomeFeedState),e.toggleHomeFeedStateLives&&m(t,s,e.toggleHomeFeedStateLives),e.toggleHomeFeedStatePremieres&&d(t,s,e.toggleHomeFeedStatePremieres),e.toggleSubscriptionFeedState&&p(t,s,e.toggleSubscriptionFeedState),e.toggleSubscriptionFeedStateLives&&w(t,s,e.toggleSubscriptionFeedStateLives),e.toggleSubscriptionFeedStatePremieres&&y(t,s,e.toggleSubscriptionFeedStatePremieres),e.toggleTrendingFeedState&&F(t,s,e.toggleTrendingFeedState),e.toggleSearchState&&v(t,s,e.toggleSearchState),e.toggleRecommendedState&&_(t,s,e.toggleRecommendedState),e.toggleNotificationState&&T(t,s,e.toggleNotificationState),e.toggleTabState&&k(t,s,e.toggleTabState),e.toggleHomeTabState&&H(t,s,e.toggleHomeTabState),e.toggleRegularState&&L(t,s,e.toggleRegularState)}o||x(s)}const R=["https://www.youtube.com/","https://www.youtube.com/?app=desktop","https://m.youtube.com/"],S=["https://www.youtube.com/feed/subscriptions","https://www.youtube.com/feed/subscriptions?app=desktop","https://m.youtube.com/feed/subscriptions","https://www.youtube.com/feed/subscriptions?flow=1"],E=["https://www.youtube.com/feed/trending","https://www.youtube.com/gaming","https://m.youtube.com/feed/explore","https://m.youtube.com/feed/trending"],P=["https://www.youtube.com/channel/","https://www.youtube.com/@","https://www.youtube.com/user/","https://www.youtube.com/c/","https://m.youtube.com/channel/","https://m.youtube.com/@","https://m.youtube.com/user/","https://m.youtube.com/c/"];function f(t,s,o){if(t.url.startsWith("https://www.youtube.com/")||t.url.startsWith("https://m.youtube.com/")){const e=["assets/navigation_button.css"];o&&c(s,e),o||g(s,e)}}function h(t,s,o){if(R.includes(t.url)){const e=["assets/home_shorts.css"];o&&c(s,e),o||g(s,e)}}function m(t,s,o){if(t.url==="https://www.youtube.com/"){const e=["assets/home_lives.css"];o&&c(s,e),o||g(s,e)}}function d(t,s,o){if(t.url==="https://www.youtube.com/"){const e=["assets/home_premieres.css"];o&&c(s,e),o||g(s,e)}}function p(t,s,o){if(S.includes(t.url)){const e=["assets/subscriptions_shorts.css","assets/subscriptions_shorts_list.css","assets/subscriptions_feed_fix.css"];o&&c(s,e),o||g(s,e)}if(t.url==="https://www.youtube.com/feed/subscriptions?flow=2"){const e=["assets/subscriptions_shorts_list.css"];o&&c(s,e),o||g(s,e)}}function w(t,s,o){if(S.includes(t.url)){const e=["assets/subscriptions_lives.css","assets/subscriptions_feed_fix.css"];o&&c(s,e),o||g(s,e)}}function y(t,s,o){if(S.includes(t.url)){const e=["assets/subscriptions_premieres.css","assets/subscriptions_feed_fix.css"];o&&c(s,e),o||g(s,e)}}function F(t,s,o){if(E.some(e=>t.url.startsWith(e))){const e=["assets/trending_shorts.css"];o&&c(s,e),o||g(s,e)}}function v(t,s,o){if(t.url.startsWith("https://www.youtube.com/results")||t.url.startsWith("https://m.youtube.com/results")){const e=["assets/search_shorts.css"];o&&c(s,e),o||g(s,e)}}function _(t,s,o){if(t.url.startsWith("https://www.youtube.com/watch")){const e=["assets/recommended_shorts.css"];o&&c(s,e),o||g(s,e)}}function T(t,s,o){if(t.url.startsWith("https://www.youtube.com/")){const e=["assets/notification_shorts.css"];o&&c(s,e),o||g(s,e)}}function H(t,s,o){if(P.some(e=>t.url.startsWith(e))){const e=["assets/home_tab_shorts.css"];o&&c(s,e),o||g(s,e)}}function k(t,s,o){if(P.some(e=>t.url.startsWith(e))){const e=["assets/channel_shorts_tab.css"];o?(chrome.scripting.executeScript({function:()=>{let r=0;function i(){if(r>=25){r=0;return}const l=document.querySelectorAll(".tab-content"),u=Array.from(l).filter(n=>n.textContent.replace(/\s/g,"").replace(/\n/g,"")==="Shorts");u.length>0?(u.forEach(n=>{n.parentNode.style.display="none"}),r=0):(r++,setTimeout(i,100))}i()},target:{tabId:s}}).catch(r=>{console.log("Error executing script",r)}),c(s,e)):(chrome.scripting.executeScript({function:()=>{let r=0;function i(){if(r>=25){r=0;return}const l=document.querySelectorAll(".tab-content"),u=Array.from(l).filter(n=>n.textContent.replace(/\s/g,"").replace(/\n/g,"")==="Shorts");u.length>0?(u.forEach(n=>{n.parentNode.style.display="inline-flex"}),r=0):(r++,setTimeout(i,100))}i()},target:{tabId:s}}).catch(r=>{console.log("Error executing script",r)}),g(s,e))}}function L(t,s,o){if(t.url.startsWith("https://www.youtube.com/shorts/")||t.url.startsWith("https://m.youtube.com/shorts/")){let r=function(l){const u=/\/shorts\/([^/]+)/,n=l.match(u);return n?n[1]:null};var e=r;const i=r(t.url);if(i&&o){const l=`https://youtube.com/watch?v=${i}`;chrome.tabs.update(s,{url:l})}}}
