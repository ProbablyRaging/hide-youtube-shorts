chrome.runtime.onInstalled.addListener(async t=>{if(t.reason==="install"&&(chrome.storage.sync.set({presentModal:!0,toggleState:!0,toggleNavState:!0,toggleHomeFeedState:!0,toggleHomeFeedStateLives:!1,toggleHomeFeedStatePremieres:!1,toggleSubscriptionFeedState:!0,toggleSubscriptionFeedStateLives:!1,toggleSubscriptionFeedStatePremieres:!1,toggleTrendingFeedState:!0,toggleSearchState:!0,toggleRecommendedState:!0,toggleTabState:!0,toggleHomeTabState:!0,toggleTurboState:!1,toggleRegularState:!0,toggleNotificationState:!0}).catch(()=>{console.log("[STORAGE] Could not set storage item")}),chrome.tabs.query({url:["https://www.youtube.com/*","https://m.youtube.com/*"]},function(o){o.forEach(s=>{chrome.tabs.reload(s.id)})}),chrome.action.setBadgeBackgroundColor({color:"#ed5a64"}),chrome.action.setBadgeText({text:"1"})),t.reason==="update"){const o=["toggleState","toggleNavState","toggleHomeFeedState","toggleHomeFeedStateLives","toggleHomeFeedStatePremieres","toggleSubscriptionFeedState","toggleSubscriptionFeedStateLives","toggleSubscriptionFeedStatePremieres","toggleTrendingFeedState","toggleSearchState","toggleRecommendedState","toggleTabState","toggleHomeTabState","toggleTurboState","toggleRegularState","toggleNotificationState"],s=await chrome.storage.sync.get(o);for(const e of o)(!(e in s)||s[e]===void 0)&&await chrome.storage.sync.set({[e]:!1});chrome.storage.sync.set({presentModal:!0}).catch(()=>{console.log("[STORAGE] Could not set storage item")}),chrome.action.setBadgeBackgroundColor({color:"#ed5a64"}),chrome.action.setBadgeText({text:"1"})}});function f(){return chrome.runtime.id?chrome.storage.sync.get(["toggleState","toggleNavState","toggleHomeFeedState","toggleHomeFeedStateLives","toggleHomeFeedStatePremieres","toggleSubscriptionFeedState","toggleSubscriptionFeedStateLives","toggleSubscriptionFeedStatePremieres","toggleTrendingFeedState","toggleSearchState","toggleRecommendedState","toggleTabState","toggleHomeTabState","toggleTurboState","toggleRegularState","toggleNotificationState","blockList"]):location.reload()}function c(t,o){chrome.scripting.insertCSS({files:o,target:{tabId:t}}).catch(s=>{console.log("Error inserting styles",s)})}function n(t,o){chrome.scripting.removeCSS({files:o,target:{tabId:t}}).catch(s=>{console.log("Error removing styles",s)})}function R(t){chrome.scripting.removeCSS({files:["channel_shorts_tab.css","assets/home_lives.css","assets/home_premieres.css","assets/home_shorts.css","assets/home_tab_shorts.css","assets/navigation_button.css","assets/notification_shorts.css","assets/recommended_shorts.css","assets/search_shorts.css","assets/subscriptions_feed_fix.css","assets/subscriptions_lives.css","assets/subscriptions_premieres.css","assets/subscriptions_shorts.css","assets/subscriptions_shorts_list.css","assets/trending_shorts.css"],target:{tabId:t}}).catch(o=>{console.log("Error removing styles",o)}),chrome.scripting.executeScript({function:()=>{let o=0;function s(){if(o>=25){o=0;return}const e=document.querySelectorAll(".tab-content"),r=Array.from(e).filter(i=>i.textContent.replace(/\s/g,"").replace(/\n/g,"")==="Shorts");r.length>0?(r.forEach(i=>{i.parentNode.style.display="inline-flex"}),o=0):(o++,setTimeout(s,100))}s()},target:{tabId:t}}).catch(o=>{console.log("Error executing script",o)})}chrome.runtime.onMessage.addListener(async function(t,o,s){if(t.checkStates){const e=await f();chrome.tabs.query({url:["https://www.youtube.com/*","https://m.youtube.com/*"]},function(r){r.forEach(i=>{t.checkStates==="toggleState"&&E(i,i.id,e.toggleState),t.checkStates==="toggleNavState"&&S(i,i.id,e.toggleNavState),t.checkStates==="toggleHomeFeedState"&&m(i,i.id,e.toggleHomeFeedState),t.checkStates==="toggleHomeFeedStateLives"&&d(i,i.id,e.toggleHomeFeedStateLives),t.checkStates==="toggleHomeFeedStatePremieres"&&p(i,i.id,e.toggleHomeFeedStatePremieres),t.checkStates==="toggleSubscriptionFeedState"&&y(i,i.id,e.toggleSubscriptionFeedState),t.checkStates==="toggleSubscriptionFeedStateLives"&&w(i,i.id,e.toggleSubscriptionFeedStateLives),t.checkStates==="toggleSubscriptionFeedStatePremieres"&&F(i,i.id,e.toggleSubscriptionFeedStatePremieres),t.checkStates==="toggleTrendingFeedState"&&v(i,i.id,e.toggleTrendingFeedState),t.checkStates==="toggleSearchState"&&T(i,i.id,e.toggleSearchState),t.checkStates==="toggleRecommendedState"&&_(i,i.id,e.toggleRecommendedState),t.checkStates==="toggleNotificationState"&&H(i,i.id,e.toggleNotificationState),t.checkStates==="toggleTabState"&&L(i,i.id,e.toggleTabState),t.checkStates==="toggleHomeTabState"&&k(i,i.id,e.toggleHomeTabState),t.checkStates==="toggleRegularState"&&x(i,i.id,e.toggleRegularState)})})}if(t.blockList){const e=await f();chrome.tabs.query({url:["https://www.youtube.com/*","https://m.youtube.com/*"]},function(r){r.forEach(i=>{t.blockList==="add"&&u(i.id,"add",e.blockList),t.blockList.action==="remove"&&u(i.id,"remove",t.blockList.channelName),t.blockList==="clear"&&u(i.id,"clear",e.blockList)})})}});chrome.tabs.onUpdated.addListener(async function(t,o,s){if(chrome.runtime.id&&(s.url.startsWith("https://www.youtube.com/")||s.url.startsWith("https://m.youtube.com/"))){const e=await f();if(!e.toggleState||o.status!=="loading")return;e.toggleNavState&&S(s,t,e.toggleNavState),e.toggleHomeFeedState&&m(s,t,e.toggleHomeFeedState),e.toggleHomeFeedStateLives&&d(s,t,e.toggleHomeFeedStateLives),e.toggleHomeFeedStatePremieres&&p(s,t,e.toggleHomeFeedStatePremieres),e.toggleSubscriptionFeedState&&y(s,t,e.toggleSubscriptionFeedState),e.toggleSubscriptionFeedStateLives&&w(s,t,e.toggleSubscriptionFeedStateLives),e.toggleSubscriptionFeedStatePremieres&&F(s,t,e.toggleSubscriptionFeedStatePremieres),e.toggleTrendingFeedState&&v(s,t,e.toggleTrendingFeedState),e.toggleSearchState&&T(s,t,e.toggleSearchState),e.toggleRecommendedState&&_(s,t,e.toggleRecommendedState),e.toggleNotificationState&&H(s,t,e.toggleNotificationState),e.toggleTabState&&L(s,t,e.toggleTabState),e.toggleHomeTabState&&k(s,t,e.toggleHomeTabState),e.toggleRegularState&&x(s,t,e.toggleRegularState),e.blockList.length>0&&u(t,"add",e.blockList)}});async function E(t,o,s){if(s){const e=await f();e.toggleNavState&&S(t,o,e.toggleNavState),e.toggleHomeFeedState&&m(t,o,e.toggleHomeFeedState),e.toggleHomeFeedStateLives&&d(t,o,e.toggleHomeFeedStateLives),e.toggleHomeFeedStatePremieres&&p(t,o,e.toggleHomeFeedStatePremieres),e.toggleSubscriptionFeedState&&y(t,o,e.toggleSubscriptionFeedState),e.toggleSubscriptionFeedStateLives&&w(t,o,e.toggleSubscriptionFeedStateLives),e.toggleSubscriptionFeedStatePremieres&&F(t,o,e.toggleSubscriptionFeedStatePremieres),e.toggleTrendingFeedState&&v(t,o,e.toggleTrendingFeedState),e.toggleSearchState&&T(t,o,e.toggleSearchState),e.toggleRecommendedState&&_(t,o,e.toggleRecommendedState),e.toggleNotificationState&&H(t,o,e.toggleNotificationState),e.toggleTabState&&L(t,o,e.toggleTabState),e.toggleHomeTabState&&k(t,o,e.toggleHomeTabState),e.toggleRegularState&&x(t,o,e.toggleRegularState),e.blockList.length>0&&u(o,"add",e.blockList)}s||R(o)}const N=["https://www.youtube.com/","https://www.youtube.com/?app=desktop","https://m.youtube.com/"],h=["https://www.youtube.com/feed/subscriptions","https://www.youtube.com/feed/subscriptions?app=desktop","https://m.youtube.com/feed/subscriptions","https://www.youtube.com/feed/subscriptions?flow=1"],b=["https://www.youtube.com/feed/trending","https://www.youtube.com/gaming","https://m.youtube.com/feed/explore","https://m.youtube.com/feed/trending"],P=["https://www.youtube.com/channel/","https://www.youtube.com/@","https://www.youtube.com/user/","https://www.youtube.com/c/","https://m.youtube.com/channel/","https://m.youtube.com/@","https://m.youtube.com/user/","https://m.youtube.com/c/"];function u(t,o,s){o==="add"&&s.forEach(e=>{chrome.scripting.insertCSS({css:`
            ytd-rich-item-renderer:has(a[href*="/@${e}"]) {
                display: none !important;
            }
            ytd-shelf-renderer:has(a[href*="/@${e}"]) {
                display: none !important;
            }
            ytd-video-renderer:has(a[href*="/@${e}"]) {
                display: none !important;
            }
            `,target:{tabId:t}}).catch(r=>{console.log("Error inserting styles",r)})}),o==="remove"&&chrome.scripting.insertCSS({css:`
            ytd-rich-item-renderer:has(a[href*="/@${s}"]) {
                display: inline-flex !important;
            }
            ytd-shelf-renderer:has(a[href*="/@${s}"]) {
                display: inline-flex !important;
            }
            ytd-video-renderer:has(a[href*="/@${s}"]) {
                display: inline-flex !important;
            }
            `,target:{tabId:t}}).catch(e=>{console.log("Error inserting styles",e)}),o==="clear"&&s.forEach(e=>{chrome.scripting.insertCSS({css:`
                ytd-rich-item-renderer:has(a[href*="/@${e}"]) {
                    display: inline-flex !important;
                }
                ytd-shelf-renderer:has(a[href*="/@${e}"]) {
                    display: inline-flex !important;
                }
                ytd-video-renderer:has(a[href*="/@${e}"]) {
                    display: inline-flex !important;
                }
            `,target:{tabId:t}}).catch(r=>{console.log("Error inserting styles",r)})})}function S(t,o,s){if(t.url.startsWith("https://www.youtube.com/")||t.url.startsWith("https://m.youtube.com/")){const e=["assets/navigation_button.css"];s&&c(o,e),s||n(o,e)}}function m(t,o,s){if(N.includes(t.url)){const e=["assets/home_shorts.css"];s&&c(o,e),s||n(o,e)}}function d(t,o,s){if(t.url==="https://www.youtube.com/"){const e=["assets/home_lives.css"];s&&c(o,e),s||n(o,e)}}function p(t,o,s){if(t.url==="https://www.youtube.com/"){const e=["assets/home_premieres.css"];s&&c(o,e),s||n(o,e)}}function y(t,o,s){if(h.includes(t.url)){const e=["assets/subscriptions_shorts.css","assets/subscriptions_shorts_list.css","assets/subscriptions_feed_fix.css"];s&&c(o,e),s||n(o,e)}if(t.url==="https://www.youtube.com/feed/subscriptions?flow=2"){const e=["assets/subscriptions_shorts_list.css"];s&&c(o,e),s||n(o,e)}}function w(t,o,s){if(h.includes(t.url)){const e=["assets/subscriptions_lives.css","assets/subscriptions_feed_fix.css"];s&&c(o,e),s||n(o,e)}}function F(t,o,s){if(h.includes(t.url)){const e=["assets/subscriptions_premieres.css","assets/subscriptions_feed_fix.css"];s&&c(o,e),s||n(o,e)}}function v(t,o,s){if(b.some(e=>t.url.startsWith(e))){const e=["assets/trending_shorts.css"];s&&c(o,e),s||n(o,e)}}function T(t,o,s){if(t.url.startsWith("https://www.youtube.com/results")||t.url.startsWith("https://m.youtube.com/results")){const e=["assets/search_shorts.css"];s&&c(o,e),s||n(o,e)}}function _(t,o,s){if(t.url.startsWith("https://www.youtube.com/watch")){const e=["assets/recommended_shorts.css"];s&&c(o,e),s||n(o,e)}}function H(t,o,s){if(t.url.startsWith("https://www.youtube.com/")){const e=["assets/notification_shorts.css"];s&&c(o,e),s||n(o,e)}}function k(t,o,s){if(P.some(e=>t.url.startsWith(e))){const e=["assets/home_tab_shorts.css"];s&&c(o,e),s||n(o,e)}}function L(t,o,s){if(P.some(e=>t.url.startsWith(e))){const e=["assets/channel_shorts_tab.css"];s?(chrome.scripting.executeScript({function:()=>{let r=0;function i(){if(r>=25){r=0;return}const l=document.querySelectorAll(".tab-content"),a=Array.from(l).filter(g=>g.textContent.replace(/\s/g,"").replace(/\n/g,"")==="Shorts");a.length>0?(a.forEach(g=>{g.parentNode.style.display="none"}),r=0):(r++,setTimeout(i,100))}i()},target:{tabId:o}}).catch(r=>{console.log("Error executing script",r)}),c(o,e)):(chrome.scripting.executeScript({function:()=>{let r=0;function i(){if(r>=25){r=0;return}const l=document.querySelectorAll(".tab-content"),a=Array.from(l).filter(g=>g.textContent.replace(/\s/g,"").replace(/\n/g,"")==="Shorts");a.length>0?(a.forEach(g=>{g.parentNode.style.display="inline-flex"}),r=0):(r++,setTimeout(i,100))}i()},target:{tabId:o}}).catch(r=>{console.log("Error executing script",r)}),n(o,e))}}function x(t,o,s){if(t.url.startsWith("https://www.youtube.com/shorts/")||t.url.startsWith("https://m.youtube.com/shorts/")){let r=function(l){const a=/\/shorts\/([^/]+)/,g=l.match(a);return g?g[1]:null};var e=r;const i=r(t.url);if(i&&s){const l=`https://youtube.com/watch?v=${i}`;chrome.tabs.update(o,{url:l})}}}
